apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: canary-route
  namespace: default
spec:
  parentRefs:
  - name: example-gateway
    namespace: default
  rules:
  - matches:
    - path:
        type: PathPrefix
        value: /
    backendRefs:
    # 95% to stable version
    - name: app-stable
      port: 80
      weight: 95
    # 5% to canary version
    - name: app-canary
      port: 80
      weight: 5
---
# Canary Deployment Strategy:
# 1. Deploy new version alongside old version
# 2. Start with small weight (5-10%)
# 3. Monitor metrics (latency, error rate, etc.)
# 4. Gradually increase weight if metrics are good
# 5. Eventually shift 100% to new version
# 6. Remove old version

